{%- from "/macros/translation.html" import transbag -%}
{%- set t_agenda_text = transbag('translate', this.alt, 'agenda_text') -%}

{%- set dates = site.query('/dates').order_by('date') -%}

<h2 class="text-center">{{ t_agenda_text }}</h2>
<h3 class="text-center">
{{- dates.all()[0].date.day }}th - {{ dates.all()[-1].date.day }}th {{ dates.all()[0].date.strftime('%B') -}} {#- 9th - 11th February -#}
</h3>

<ul class="nav center-nav nav-schedule" role="tablist" id="schedule-tabs">
{% for date in dates %}
  <li class="nav-item{% if loop.index == 1 %} active{% endif %}">
    <a class="nav-link" data-toggle="pill" href="#{{ date.date.strftime('%Y-%m-%d') }}" aria-controls="{{ date.date.strftime('%Y-%m-%d') }}" role="tab">
    {{- date.date.strftime('%A %d') }}th</a> {#- Friday 9th #}
  </li>
{%- endfor %}
</ul>

<div class="tab-content text-center">
{% for date in dates %}
  <div class="tab-pane tab-schedule{% if loop.index == 1 %} active{% endif %}" id="{{ date.date.strftime('%Y-%m-%d') }}" role="tabpanel">
  {# Complex expressions doent work in filter() #}
  {% set start = date.date %}
  {% set end = date.date_end %}
  {% set talks = site.query('/talks', alt=this.alt).filter((F.datetime >= start) and (F.datetime <= end )) %}
  {% for talk in talks.order_by('datetime') %}
    <div class="item-schedule row">
      <div class="time-schedule col-sm-3">
        <span class="hour">
          {{- talk.datetime.strftime('%H') -}}
        </span>
        <span class="minutes">:
          {{- talk.datetime.strftime('%M') -}}
        </span>
      </div>
      <div class="talk-details row col-sm-9">
        <div class="room-schedule">
        {{ talk.room }}
        </div>
        <div class="speaker-schedule">
          {% for speaker in talk.authors %}
            {% set speaker = site.query('/speakers', alt=this.alt).get(speaker) %}
            <span class="speaker-name">
            {{- speaker.name }} {{ speaker.last_name -}}
            </span>
            <span class="speaker-country">
            ({{ speaker.country }})
            </span>
          {% endfor %}
        </div>
        <div class="talk-name">
        {{ talk.name }}
        </div>
      </div>
    </div>
  {% endfor %}
  </div>
{% endfor %}
</div>

<script>
$('#schedule-tabs a').click(function (e) {
  e.preventDefault()
  $(this).tab('show')
})
</script>
